generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model User {
  userId              Int                @id @default(autoincrement())
  email               String             @unique
  phoneNumber         String?            @unique
  name                String?
  password            String
  role                String             @default("user")
  remarks             String?            @db.Text
  profilePicture      String?            @db.LongText
  emailVerified       Boolean            @default(false)
  resetToken          String?
  resetTokenExpiry    DateTime?
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  addresses           Address[]
  cartItems           CartItem[]
  comments            Comment[]
  buyerConversations  Conversation[]     @relation("BuyerConversations")
  sellerConversations Conversation[]     @relation("SellerConversations")
  sentMessages        Message[]
  notifications       Notification[]
  orders              Order[]
  otps                Otp[]
  products            Product[]
  recipeReviews       RecipeReview[]
  savedRecipes        SavedRecipe[]
  sellerApplication   SellerApplication?

  @@map("users")
}

model Product {
  productId     Int            @id @default(autoincrement())
  name          String
  description   String         @db.Text
  price         Float
  category      String
  image         String         @db.LongText
  stock         Int            @default(0)
  userId        Int
  featured      Boolean        @default(false)
  rating        Float          @default(0)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  cartItems     CartItem[]
  comments      Comment[]
  conversations Conversation[]
  orderItems    OrderItem[]
  user          User           @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId], map: "products_userId_fkey")
  @@map("products")
}

model Recipe {
  recipeId     Int                 @id @default(autoincrement())
  title        String
  description  String              @db.Text
  image        String              @db.LongText
  prepTime     Int
  cookTime     Int
  servings     Int
  difficulty   String
  rating       Float               @default(0)
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  ingredients  RecipeIngredient[]
  instructions RecipeInstruction[]
  reviews      RecipeReview[]
  savedRecipes SavedRecipe[]

  @@map("recipes")
}

model RecipeIngredient {
  ingredientId Int     @id @default(autoincrement())
  recipeId     Int
  name         String
  quantity     String?
  order        Int
  recipe       Recipe  @relation(fields: [recipeId], references: [recipeId], onDelete: Cascade)

  @@index([recipeId], map: "recipe_ingredients_recipeId_fkey")
  @@map("recipe_ingredients")
}

model RecipeInstruction {
  instructionId Int    @id @default(autoincrement())
  recipeId      Int
  stepNumber    Int
  instruction   String @db.Text
  recipe        Recipe @relation(fields: [recipeId], references: [recipeId], onDelete: Cascade)

  @@index([recipeId], map: "recipe_instructions_recipeId_fkey")
  @@map("recipe_instructions")
}

model CartItem {
  cartItemId Int      @id @default(autoincrement())
  userId     Int
  productId  Int
  quantity   Int      @default(1)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  product    Product  @relation(fields: [productId], references: [productId], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([productId], map: "cart_items_productId_fkey")
  @@map("cart_items")
}

model Order {
  orderId               Int                    @id @default(autoincrement())
  userId                Int
  status                String                 @default("pending")
  totalAmount           Float
  shippingAddress       String                 @db.Text
  billingAddress        String                 @db.Text
  paymentMethod         String
  adminApprovalRequired Boolean                @default(false)
  cancellationReason    String?
  cancelledAt           DateTime?
  trackingNumber        String?
  courier               String?
  estimatedDeliveryDate DateTime?
  shippedAt             DateTime?
  deliveredAt           DateTime?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  orderItems            OrderItem[]
  trackingHistory       OrderTrackingHistory[]
  user                  User                   @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId], map: "orders_userId_fkey")
  @@map("orders")
}

model OrderItem {
  orderItemId Int      @id @default(autoincrement())
  orderId     Int
  productId   Int
  quantity    Int
  price       Float
  createdAt   DateTime @default(now())
  order       Order    @relation(fields: [orderId], references: [orderId], onDelete: Cascade)
  product     Product  @relation(fields: [productId], references: [productId], onDelete: Cascade)

  @@index([orderId], map: "order_items_orderId_fkey")
  @@index([productId], map: "order_items_productId_fkey")
  @@map("order_items")
}

model OrderTrackingHistory {
  trackingHistoryId Int      @id @default(autoincrement())
  orderId           Int
  status            String
  location          String?
  description       String
  createdAt         DateTime @default(now())
  order             Order    @relation(fields: [orderId], references: [orderId], onDelete: Cascade)

  @@index([orderId], map: "order_tracking_history_orderId_fkey")
  @@map("order_tracking_history")
}

model SellerApplication {
  applicationId Int      @id @default(autoincrement())
  userId        Int      @unique
  businessName  String
  businessType  String
  description   String
  contactNumber String
  address       String
  businessLogo  String?  @db.LongText
  primaryId     String?  @db.LongText
  secondaryId   String?  @db.LongText
  status        String   @default("pending")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("seller_applications")
}

model Conversation {
  conversationId Int       @id @default(autoincrement())
  sellerId       Int
  buyerId        Int
  productId      Int
  status         String    @default("active")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  buyer          User      @relation("BuyerConversations", fields: [buyerId], references: [userId], onDelete: Cascade)
  product        Product   @relation(fields: [productId], references: [productId], onDelete: Cascade)
  seller         User      @relation("SellerConversations", fields: [sellerId], references: [userId], onDelete: Cascade)
  messages       Message[]

  @@unique([sellerId, buyerId, productId])
  @@index([buyerId], map: "conversations_buyerId_fkey")
  @@index([productId], map: "conversations_productId_fkey")
  @@map("conversations")
}

model Message {
  messageId      Int          @id @default(autoincrement())
  conversationId Int
  senderId       Int
  content        String
  isRead         Boolean      @default(false)
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [conversationId], onDelete: Cascade)
  sender         User         @relation(fields: [senderId], references: [userId], onDelete: Cascade)

  @@index([conversationId], map: "messages_conversationId_fkey")
  @@index([senderId], map: "messages_senderId_fkey")
  @@map("messages")
}

model Notification {
  notificationId Int      @id @default(autoincrement())
  userId         Int
  title          String
  message        String
  type           String
  isRead         Boolean  @default(false)
  createdAt      DateTime @default(now())
  user           User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId], map: "notifications_userId_fkey")
  @@map("notifications")
}

model Comment {
  commentId     Int       @id @default(autoincrement())
  productId     Int
  userId        Int
  rating        Int
  content       String
  sellerReply   String?
  sellerReplyAt DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  product       Product   @relation(fields: [productId], references: [productId], onDelete: Cascade)
  user          User      @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([productId, userId])
  @@index([userId], map: "comments_userId_fkey")
  @@map("comments")
}

model RecipeReview {
  reviewId  Int      @id @default(autoincrement())
  recipeId  Int
  userId    Int
  rating    Int
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  recipe    Recipe   @relation(fields: [recipeId], references: [recipeId], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([recipeId, userId])
  @@index([userId], map: "recipe_reviews_userId_fkey")
  @@map("recipe_reviews")
}

model SavedRecipe {
  savedRecipeId Int      @id @default(autoincrement())
  userId        Int
  recipeId      Int
  notes         String?  @db.Text
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  recipe        Recipe   @relation(fields: [recipeId], references: [recipeId], onDelete: Cascade)
  user          User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([userId, recipeId])
  @@index([recipeId], map: "saved_recipes_recipeId_fkey")
  @@map("saved_recipes")
}

model Otp {
  otpId     Int      @id @default(autoincrement())
  userId    Int?
  email     String
  code      String
  verified  Boolean  @default(false)
  attempts  Int      @default(0)
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([email])
  @@index([userId], map: "otps_userId_fkey")
  @@map("otps")
}

model PendingRegistration {
  registrationId Int      @id @default(autoincrement())
  email          String   @unique
  name           String
  password       String
  phoneNumber    String?
  role           String   @default("user")
  expiresAt      DateTime
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("pending_registrations")
}

model Address {
  addressId     Int      @id @default(autoincrement())
  userId        Int
  fullName      String
  phoneNumber   String
  region        String
  province      String
  city          String
  barangay      String
  streetAddress String
  postalCode    String
  landmark      String?
  isDefault     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId], map: "addresses_userId_fkey")
  @@map("addresses")
}
